name: Quality Checks
on:
  push:
    branches: [ testci ]

jobs:
  installation:
    name: ğŸ§ª Test plugin installation

    runs-on: ubuntu-latest

    strategy:
      matrix:
        php-versions: ['7.4']

    steps:
      - name: ğŸš« Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.4.0
        with:
          access_token: ${{ github.token }}

      - name: â¬‡ Checkout
        uses: actions/checkout@v3

      - name: ğŸ”§ Install PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-versions }}
          extensions: intl, zip, zlib
          coverage: none
          ini-values: memory_limit=-1
          tools: composer:v1

      - name: âš¡ï¸ Test plugin installation
        run: composer install --prefer-dist

  phplint:
    name: ğŸ§ª PHP Parallel Lint

    runs-on: ubuntu-latest

    strategy:
      matrix:
        php-versions: ['7.4']

    steps:
      - name: ğŸš« Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.4.0
        with:
          access_token: ${{ github.token }}

      - name: â¬‡ Checkout
        uses: actions/checkout@v3

      - name: ğŸ”§ Install PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-versions }}
          extensions: intl, zip, zlib
          coverage: none
          ini-values: memory_limit=-1
          tools: parallel-lint

      - name: âš¡ï¸ Run parallel-lint
        run: parallel-lint .

  phpcs:
    name: ğŸ§ª PHP Code Sniffer

    runs-on: ubuntu-latest

    strategy:
      matrix:
        php-versions: ['7.4']

    steps:
      - name: ğŸš« Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.4.0
        with:
          access_token: ${{ github.token }}

      - name: â¬‡ Checkout
        uses: actions/checkout@v3

      - name: ğŸ”§ Install PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-versions }}
          extensions: intl, zip, zlib
          coverage: none
          ini-values: memory_limit=-1
          tools: cs2pr, phpcs

      - name: âš¡ï¸ Run phpcs
        run: phpcs -q --report=checkstyle . | cs2pr

  phpcpd:
    name: ğŸ§ª PHP Copy/Paste Detector

    runs-on: ubuntu-latest

    strategy:
      matrix:
        php-versions: ['7.4']

    steps:
      - name: ğŸš« Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.4.0
        with:
          access_token: ${{ github.token }}

      - name: â¬‡ Checkout
        uses: actions/checkout@v3

      - name: ğŸ”§ Install PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-versions }}
          extensions: intl, zip, zlib
          coverage: none
          ini-values: memory_limit=-1
          tools: phpcpd

      - name: âš¡ï¸ Run phpcpd
        run: phpcpd .

  psalm:
    name: ğŸ§ª Psalm

    runs-on: ubuntu-latest

    strategy:
      matrix:
        php-versions: ['7.4']

    steps:
      - name: ğŸš« Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.4.0
        with:
          access_token: ${{ github.token }}

      - name: â¬‡ Checkout
        uses: actions/checkout@v3

      - name: ğŸ”§ Install PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-versions }}
          extensions: intl, zip, zlib
          coverage: none
          ini-values: memory_limit=-1
          tools: psalm

      - name: âš¡ï¸ Run psalm
        run: psalm --output-format=github --root=.

  phpstan:
    name: ğŸ§ª PhpStan

    runs-on: ubuntu-latest

    strategy:
      matrix:
        php-versions: ['7.4']

    steps:
      - name: ğŸš« Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.4.0
        with:
          access_token: ${{ github.token }}

      - name: â¬‡ Checkout
        uses: actions/checkout@v3

      - name: ğŸ”§ Install PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-versions }}
          extensions: intl, zip, zlib
          coverage: none
          ini-values: memory_limit=-1
          tools: phpstan

      - name: âš¡ï¸ Run phpstan
        run: phpstan analyse --error-format github .

  phpmd:
    name: ğŸ§ª PHP Mess Detector

    runs-on: ubuntu-latest

    strategy:
      matrix:
        php-versions: ['7.4']

    steps:
      - name: ğŸš« Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.4.0
        with:
          access_token: ${{ github.token }}

      - name: â¬‡ Checkout
        uses: actions/checkout@v3

      - name: ğŸ”§ Install PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-versions }}
          extensions: intl, zip, zlib
          coverage: none
          ini-values: memory_limit=-1
          tools: phpmd

      - name: âš¡ï¸ Run phpmd
        run: phpmd ./. text ./phpmd.xml

  deptrac:
    name: ğŸ§ª Deptrac

    runs-on: ubuntu-latest

    strategy:
      matrix:
        php-versions: ['7.4']

    steps:
      - name: ğŸš« Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.4.0
        with:
          access_token: ${{ github.token }}

      - name: â¬‡ Checkout
        uses: actions/checkout@v3

      - name: ğŸ”§ Install PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-versions }}
          extensions: intl, zip, zlib
          coverage: none
          ini-values: memory_limit=-1
          tools: deptrac

      - name: âš¡ï¸ Run deptrac
        run: deptrac --formatter-github-actions=true

  phpmnd:
    name: ğŸ§ª PHP Magic Number Detector

    runs-on: ubuntu-latest

    strategy:
      matrix:
        php-versions: ['7.4']

    steps:
      - name: ğŸš« Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.4.0
        with:
          access_token: ${{ github.token }}

      - name: â¬‡ Checkout
        uses: actions/checkout@v3

      - name: ğŸ”§ Install PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-versions }}
          extensions: intl, zip, zlib
          coverage: none
          ini-values: memory_limit=-1
          tools: phpmnd

      - name: âš¡ï¸ Run phpmnd
        run: phpmnd .
